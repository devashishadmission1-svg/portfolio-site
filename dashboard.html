<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <!-- Simple Nav -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">Port. Admin</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="#" onclick="logout()">Logout</a></li>
            </ul>
        </div>
    </nav>

    <section class="section">
        <div class="container dashboard-container fade-in">
            <h2 class="section-title">Dashboard</h2>

            <div class="dashboard-tabs">
                <button class="tab-btn active" onclick="switchTab('blog')">Post Blog</button>
                <button class="tab-btn" onclick="switchTab('gallery')">Add Photo</button>
            </div>

            <!-- Blog Tab -->
            <div id="tab-blog" class="tab-content active">
                <form id="blog-form">
                    <input type="text" id="blog-title" class="minimal-input" placeholder="Title" required>
                    <textarea id="blog-content" class="minimal-textarea" rows="10" placeholder="Write your thoughts..."
                        required></textarea>
                    <button type="submit" class="btn btn-primary">Publish Post</button>
                </form>
            </div>

            <!-- Gallery Tab -->
            <div id="tab-gallery" class="tab-content">
                <form id="gallery-form">
                    <div style="margin-bottom: 10px;">
                        <label for="img-file"
                            style="color: var(--intro-text); display: block; margin-bottom: 5px;">Upload Image (Max
                            500KB)</label>
                        <input type="file" id="img-file" class="minimal-input" accept="image/*" required>
                    </div>
                    <input type="text" id="img-caption" class="minimal-input" placeholder="Caption (Optional)">
                    <button type="submit" class="btn btn-primary">Add to Gallery</button>
                </form>
            </div>

        </div>
    </section>

    <script>
        // Check Auth
        if (sessionStorage.getItem('isAdmin') !== 'true') {
            window.location.href = 'login.html';
        }

        function logout() {
            sessionStorage.removeItem('isAdmin');
            window.location.href = 'index.html';
        }

        // Tabs
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

            document.getElementById(`tab-${tab}`).classList.add('active');
            const btns = document.querySelectorAll('.tab-btn');
            if (tab === 'blog') btns[0].classList.add('active');
            else btns[1].classList.add('active');
        }

        // Logic to Save Data

        // BLOG POST
        document.getElementById('blog-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('blog-title').value;
            const content = document.getElementById('blog-content').value;
            const date = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            const id = Date.now().toString(); // Unique ID for comments

            const newPost = { id, title, content, date };

            // Get existing
            const posts = JSON.parse(localStorage.getItem('blogPosts')) || [];
            posts.push(newPost);
            localStorage.setItem('blogPosts', JSON.stringify(posts));

            alert('Blog posted!');
            e.target.reset();
        });

        // GALLERY IMAGE
        document.getElementById('gallery-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const fileInput = document.getElementById('img-file');
            const caption = document.getElementById('img-caption').value;
            const file = fileInput.files[0];

            if (file) {
                // Size Validation (500KB)
                if (file.size > 500 * 1024) {
                    alert('File is too large! Please upload images under 500KB to save storage space.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (event) {
                    const base64String = event.target.result;

                    const newImg = { url: base64String, caption };

                    // Get existing
                    const images = JSON.parse(localStorage.getItem('galleryImages')) || [];
                    images.push(newImg);
                    try {
                        localStorage.setItem('galleryImages', JSON.stringify(images));
                        alert('Image added!');
                        e.target.reset();
                    } catch (err) {
                        alert('Storage quota exceeded! Try deleting old items or using smaller images.');
                    }
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>

</html>